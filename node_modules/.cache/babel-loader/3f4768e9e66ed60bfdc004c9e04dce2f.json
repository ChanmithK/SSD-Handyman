{"ast":null,"code":"var _jsxFileName = \"/Users/praveenkariyawasam/Documents/SLIIT/Year 4/SEM 2/SSD/FitFlame-SSD/SSD-FitFlame/src/components/ProtectedRoute.js\",\n    _s = $RefreshSig$();\n\nimport { collection, getDocs, query, where } from \"firebase/firestore\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Navigate } from \"react-router-dom\";\nimport { useUserAuth } from \"../Context/UserAuthContext\";\nimport { db } from \"../firebase-config\";\nimport { setUserData } from \"../redux/UserDataSlice\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst usersCollectionRef = collection(db, \"users\");\n\nconst ProtectedRoute = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const dispatch = useDispatch();\n  const {\n    user\n  } = useUserAuth();\n  const [userDetails, setUserDetails] = useState(\"\");\n  useEffect(() => {\n    const getUser = async () => {\n      const filterdData = query(usersCollectionRef, where(\"user\", \"==\", user.uid));\n      const querySnapshot = await getDocs(filterdData);\n      setUserDetails(querySnapshot.docs.map(doc => ({ ...doc.data(),\n        id: doc.id\n      })));\n    };\n\n    getUser();\n    localStorage.setItem(\"token\", user.accessToken);\n  }, [user]);\n  dispatch(setUserData(JSON.stringify(userDetails[0])));\n  const token = window.localStorage.getItem(\"token\");\n\n  if (!user && !token) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/signin\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 12\n    }, this);\n  }\n\n  return children;\n};\n\n_s(ProtectedRoute, \"7+A2FefuVEQmLrdHkhOKp6hyKpo=\", false, function () {\n  return [useDispatch, useUserAuth];\n});\n\n_c = ProtectedRoute;\nexport default ProtectedRoute;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["collection","getDocs","query","where","React","useEffect","useState","useDispatch","Navigate","useUserAuth","db","setUserData","usersCollectionRef","ProtectedRoute","children","dispatch","user","userDetails","setUserDetails","getUser","filterdData","uid","querySnapshot","docs","map","doc","data","id","localStorage","setItem","accessToken","JSON","stringify","token","window","getItem"],"sources":["/Users/praveenkariyawasam/Documents/SLIIT/Year 4/SEM 2/SSD/FitFlame-SSD/SSD-FitFlame/src/components/ProtectedRoute.js"],"sourcesContent":["import { collection, getDocs, query, where } from \"firebase/firestore\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Navigate } from \"react-router-dom\";\nimport { useUserAuth } from \"../Context/UserAuthContext\";\nimport { db } from \"../firebase-config\";\nimport { setUserData } from \"../redux/UserDataSlice\";\n\nconst usersCollectionRef = collection(db, \"users\");\n\nconst ProtectedRoute = ({ children }) => {\n  const dispatch = useDispatch();\n\n  const { user } = useUserAuth();\n  const [userDetails, setUserDetails] = useState(\"\");\n\n  useEffect(() => {\n    const getUser = async () => {\n      const filterdData = query(\n        usersCollectionRef,\n        where(\"user\", \"==\", user.uid)\n      );\n      const querySnapshot = await getDocs(filterdData);\n      setUserDetails(\n        querySnapshot.docs.map((doc) => ({ ...doc.data(), id: doc.id }))\n      );\n    };\n    getUser();\n\n    localStorage.setItem(\"token\", user.accessToken);\n  }, [user]);\n  dispatch(setUserData(JSON.stringify(userDetails[0])));\n\n  const token = window.localStorage.getItem(\"token\");\n  if (!user && !token) {\n    return <Navigate to=\"/signin\" replace />;\n  }\n  return children;\n};\n\nexport default ProtectedRoute;\n"],"mappings":";;;AAAA,SAASA,UAAT,EAAqBC,OAArB,EAA8BC,KAA9B,EAAqCC,KAArC,QAAkD,oBAAlD;AACA,OAAOC,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,SAASC,WAAT,QAA4B,4BAA5B;AACA,SAASC,EAAT,QAAmB,oBAAnB;AACA,SAASC,WAAT,QAA4B,wBAA5B;;AAEA,MAAMC,kBAAkB,GAAGZ,UAAU,CAACU,EAAD,EAAK,OAAL,CAArC;;AAEA,MAAMG,cAAc,GAAG,QAAkB;EAAA;;EAAA,IAAjB;IAAEC;EAAF,CAAiB;EACvC,MAAMC,QAAQ,GAAGR,WAAW,EAA5B;EAEA,MAAM;IAAES;EAAF,IAAWP,WAAW,EAA5B;EACA,MAAM,CAACQ,WAAD,EAAcC,cAAd,IAAgCZ,QAAQ,CAAC,EAAD,CAA9C;EAEAD,SAAS,CAAC,MAAM;IACd,MAAMc,OAAO,GAAG,YAAY;MAC1B,MAAMC,WAAW,GAAGlB,KAAK,CACvBU,kBADuB,EAEvBT,KAAK,CAAC,MAAD,EAAS,IAAT,EAAea,IAAI,CAACK,GAApB,CAFkB,CAAzB;MAIA,MAAMC,aAAa,GAAG,MAAMrB,OAAO,CAACmB,WAAD,CAAnC;MACAF,cAAc,CACZI,aAAa,CAACC,IAAd,CAAmBC,GAAnB,CAAwBC,GAAD,KAAU,EAAE,GAAGA,GAAG,CAACC,IAAJ,EAAL;QAAiBC,EAAE,EAAEF,GAAG,CAACE;MAAzB,CAAV,CAAvB,CADY,CAAd;IAGD,CATD;;IAUAR,OAAO;IAEPS,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8Bb,IAAI,CAACc,WAAnC;EACD,CAdQ,EAcN,CAACd,IAAD,CAdM,CAAT;EAeAD,QAAQ,CAACJ,WAAW,CAACoB,IAAI,CAACC,SAAL,CAAef,WAAW,CAAC,CAAD,CAA1B,CAAD,CAAZ,CAAR;EAEA,MAAMgB,KAAK,GAAGC,MAAM,CAACN,YAAP,CAAoBO,OAApB,CAA4B,OAA5B,CAAd;;EACA,IAAI,CAACnB,IAAD,IAAS,CAACiB,KAAd,EAAqB;IACnB,oBAAO,QAAC,QAAD;MAAU,EAAE,EAAC,SAAb;MAAuB,OAAO;IAA9B;MAAA;MAAA;MAAA;IAAA,QAAP;EACD;;EACD,OAAOnB,QAAP;AACD,CA5BD;;GAAMD,c;UACaN,W,EAEAE,W;;;KAHbI,c;AA8BN,eAAeA,cAAf"},"metadata":{},"sourceType":"module"}